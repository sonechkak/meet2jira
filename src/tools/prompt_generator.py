from src.pipeline.elements.base import Tool


class PromptGenerator(Tool):
    """Класс для генерации промптов на основе типа документа и его содержания."""
    def __init__(self,
                 name: str = "PromptGenerator",
                 description: str = "Генерирует промпт для LLM на основе типа документа и его содержания.",
                 **kwargs):
        super().__init__(name=name, description=description, **kwargs)
        self.document_type = kwargs.get('document_type', '')
        self.text = kwargs.get('text', '')

    def run(self) -> str:
        """Возвращает специализированный промпт для конкретного типа документа."""

        prompts = {
            "financial": f"""
                Проанализируй следующий финансовый документ и создай краткое резюме:
                Документ: {self.text}

                Пожалуйста, сосредоточься на:
                - Ключевых финансовых показателях
                - Суммах и датах платежей
                - Основных финансовых операциях
                - Выводах и рекомендациях

                Создай структурированное резюме длиной не более 200 слов.
            """,

            "legal": f"""
                Проанализируй следующий юридический документ и создай краткое резюме:

                Документ: {self.text}

                Пожалуйста, сосредоточься на:
                - Сторонах договора/соглашения
                - Основных условиях и обязательствах
                - Сроках и датах
                - Ключевых юридических аспектах
                - Правах и обязанностях сторон

                Создай структурированное резюме длиной не более 200 слов.
            """,

            "medical": f"""
                Проанализируй следующий медицинский документ и создай краткое резюме:

                Документ: {self.text}

                Пожалуйста, сосредоточься на:
                - Диагнозе и симптомах
                - Рекомендованном лечении
                - Лекарственных препаратах
                - Датах и сроках
                - Важных медицинских показателях

                Создай структурированное резюме длиной не более 200 слов.
            """,

            "academic": f"""
                Проанализируй следующий академический документ и создай краткое резюме:

                Документ: {self.text}

                Пожалуйста, сосредоточься на:
                - Цели и задачах исследования
                - Методологии
                - Основных результатах и выводах
                - Практической значимости
                - Рекомендациях для дальнейших исследований

                Создай структурированное резюме длиной не более 200 слов.
            """,

            "technical": f"""
                Проанализируй следующий технический документ и создай краткое резюме:

                Документ: {self.text}

                Пожалуйста, сосредоточься на:
                - Технических характеристиках
                - Инструкциях и процедурах
                - Требованиях и спецификациях
                - Этапах выполнения
                - Важных технических деталях

                Создай структурированное резюме длиной не более 200 слов.
            """,

            "other": f"""
                Проанализируй следующий документ и создай краткое резюме:

                Документ: {self.text}

                Пожалуйста, сосредоточься на:
                - Основной теме документа
                - Ключевых моментах
                - Важных деталях
                - Выводах и рекомендациях

                Создай структурированное резюме длиной не более 200 слов.
            """
        }

        if self.document_type not in prompts:
            raise ValueError(f"Unsupported document type: {self.document_type}")

        return prompts[self.document_type]
